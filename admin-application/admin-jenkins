pipeline {
  environment {
  tag = "admin_ms"
  imageName = "usr998/atlant-devops:$tag"
  reg = 'Dockerhub'
  image = ''
  }

  agent any

  stages {
  
    stage("Maven build") {
	    steps {
	        cd $WORKSPACE
			sh "mvn clean install -DskipTests"
		}
    }
	
	stage("Build admin-ms image") {
		steps {
			script {
				image = docker.build(imageName, "./admin-application")
			}
		}
	}
	
    stage("Push image to Dockerhub") {
        steps {
            script {
                    docker.withRegistry( '', reg ) {
                    image.push('$tag')
                }
            }
        }
    }
  }

  post {
    always {
      sh "yes | docker image prune"
    }
  }
}

